{# templates/accounts/team_list.html #}
{% extends 'base.html' %}
{% block title %}Gestion de l'équipe{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">
          <i class="fas fa-users-cog me-2"></i>Gestion de l'équipe
        </h1>
        <a class="btn btn-success" href="{% url 'accounts:team_add' %}">
          <i class="fas fa-user-plus me-2"></i>Ajouter un employé
        </a>
      </div>

      {% if messages %}
      <div class="messages mb-4">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Nom d'utilisateur</th>
              <th>Nom complet</th>
              <th>Email</th>
              <th>Statut</th>
              <th>Dernière connexion</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in employees %}
            <tr>
              <td>{{ user.username }}</td>
              <td>{{ user.get_full_name|default:"-" }}</td>
              <td>
                <a href="mailto:{{ user.email }}" class="text-decoration-none">
                  {{ user.email }}
                </a>
              </td>
              <td>
                {% if user.is_active %}
                <span class="badge bg-success">Actif</span>
                {% else %}
                <span class="badge bg-danger">Inactif</span>
                {% endif %}
              </td>
              <td>
                {% if user.last_login %}
                <span title="{{ user.last_login|date:'d/m/Y H:i' }}">
                  {{ user.last_login|timesince }}
                </span>
                {% else %}
                <span class="text-muted">Jamais connecté</span>
                {% endif %}
              </td>
              <td class="text-end">
                <div class="btn-group">
                  <a href="{% url 'accounts:team_edit' user.pk %}" 
                     class="btn btn-sm btn-outline-primary" 
                     title="Modifier">
                    <i class="fas fa-edit"></i>
                  </a>
                  <button type="button"
                          class="btn btn-sm {% if user.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}"
                          data-bs-toggle="modal"
                          data-bs-target="#statusModal{{ user.pk }}"
                          title="{% if user.is_active %}Désactiver{% else %}Activer{% endif %}">
                    <i class="fas {% if user.is_active %}fa-user-slash{% else %}fa-user-check{% endif %}"></i>
                  </button>
                </div>

                {# Modal de confirmation #}
                <div class="modal fade" id="statusModal{{ user.pk }}" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">
                          {% if user.is_active %}
                          Confirmer la désactivation
                          {% else %}
                          Confirmer l'activation
                          {% endif %}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body">
                        {% if user.is_active %}
                        <p>Êtes-vous sûr de vouloir désactiver l'employé <strong>{{ user.username }}</strong> ?</p>
                        <p class="text-muted mb-0">L'employé ne pourra plus se connecter à l'application.</p>
                        {% else %}
                        <p>Êtes-vous sûr de vouloir réactiver l'employé <strong>{{ user.username }}</strong> ?</p>
                        <p class="text-muted mb-0">L'employé pourra à nouveau se connecter à l'application.</p>
                        {% endif %}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <form action="{% url 'accounts:team_toggle_status' user.pk %}" method="post" class="d-inline">
                          {% csrf_token %}
                          <button type="submit" class="btn {% if user.is_active %}btn-danger{% else %}btn-success{% endif %}">
                            <i class="fas {% if user.is_active %}fa-user-slash{% else %}fa-user-check{% endif %} me-2"></i>
                            {% if user.is_active %}Désactiver{% else %}Activer{% endif %}
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-4">
                <div class="text-muted">
                  <i class="fas fa-users fa-2x mb-3"></i>
                  <p class="mb-0">Aucun employé dans l'équipe</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
